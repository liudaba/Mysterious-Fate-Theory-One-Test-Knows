<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>âœ¨ ç„æœºå‘½ç† - æ´æ‚‰å¤©æœº âœ¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-dark: #0a0a1a;
            --bg-card: #1a1a2e;
            --bg-hover: #2a2a4a;
            --gold: #ffea00;
            --gold-dark: #ffc107;
            --purple: #a855f7;
            --purple-light: #d8b4fe;
            --red: #ff5555;
            --green: #22c55e;
            --text: #ffffff;
            --text-dim: #a0a0a0;
            --cyan: #00d4ff;
            --orange: #ff9500;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Microsoft YaHei', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
        }
        .container { max-width: 100%; padding: 10px; }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .header {
            text-align: center;
            padding: 15px 10px;
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-hover) 100%);
            border-bottom: 2px solid var(--gold-dark);
        }
        .header h1 {
            font-size: 1.5rem;
            color: var(--gold);
            text-shadow: 0 0 10px rgba(255, 234, 0, 0.5);
        }
        .header .subtitle {
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-top: 5px;
        }
        .date-info {
            font-size: 0.8rem;
            color: var(--purple-light);
            margin-top: 8px;
        }
        
        /* åº•éƒ¨å¯¼èˆªæ  */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            border-top: 1px solid var(--bg-hover);
            z-index: 100;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-dim);
            font-size: 0.7rem;
            cursor: pointer;
            padding: 5px 8px;
            transition: all 0.3s;
        }
        .nav-item.active { color: var(--gold); }
        .nav-item .icon { font-size: 1.3rem; margin-bottom: 2px; }
        
        /* å†…å®¹åŒº */
        .content {
            padding-bottom: 80px;
        }
        .page { display: none; }
        .page.active { display: block; }
        
        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 15px;
            margin: 10px;
        }
        .card-title {
            color: var(--cyan);
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* é¦–é¡µåŠŸèƒ½å¡ç‰‡ */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 10px;
        }
        .feature-card {
            background: var(--bg-hover);
            border-radius: 12px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .feature-card:active { transform: scale(0.95); }
        .feature-card .icon { font-size: 2rem; margin-bottom: 8px; }
        .feature-card .title { font-size: 0.95rem; font-weight: bold; }
        .feature-card .desc { font-size: 0.75rem; color: var(--text-dim); margin-top: 5px; }
        
        /* è¾“å…¥ç»„ä»¶ */
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }
        .input-group label { font-size: 0.9rem; }
        .input-group select, .input-group input {
            background: var(--bg-hover);
            border: 1px solid var(--purple);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        .btn {
            background: var(--purple);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 15px auto;
            transition: all 0.3s;
        }
        .btn:active { transform: scale(0.95); opacity: 0.9; }
        .btn-green { background: var(--green); }
        .btn-red { background: var(--red); }
        
        /* å…«å­—æ˜¾ç¤º */
        .bazi-row {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 10px 0;
        }
        .bazi-col {
            background: var(--bg-hover);
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
        }
        .bazi-col .label { font-size: 0.75rem; color: var(--text-dim); }
        .bazi-col .value { font-size: 1rem; color: var(--gold); font-weight: bold; }
        
        /* äº”è¡Œæ ‡ç­¾ */
        .wuxing-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        .wuxing-tag {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        .wuxing-jin { background: #E8E8E8; color: #333; }
        .wuxing-mu { background: var(--green); color: white; }
        .wuxing-shui { background: var(--cyan); color: #333; }
        .wuxing-huo { background: var(--red); color: white; }
        .wuxing-tu { background: var(--gold-dark); color: #333; }
        
        /* å®œå¿Œæ ‡ç­¾ */
        .yiji-box {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            padding: 10px;
            background: var(--bg-hover);
            border-radius: 8px;
        }
        .yiji-label {
            padding: 5px 12px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .yi-label { background: var(--green); }
        .ji-label { background: var(--red); }
        .yiji-content { font-size: 0.85rem; flex: 1; }
        
        /* å‰æ—¥åˆ—è¡¨ */
        .lucky-day-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-hover);
            border-radius: 8px;
            margin: 8px 0;
        }
        .lucky-day-item .date { font-weight: bold; }
        .lucky-day-item .lunar { font-size: 0.8rem; color: var(--purple-light); }
        .lucky-day-item .level { font-size: 0.85rem; color: var(--gold); }
        
        /* é…å¯¹ç»“æœ */
        .match-result {
            text-align: center;
            padding: 20px;
        }
        .match-score {
            font-size: 3.5rem;
            font-weight: bold;
            color: var(--gold);
        }
        .match-level { font-size: 1.3rem; font-weight: bold; margin: 10px 0; }
        .match-desc { font-size: 0.9rem; color: var(--text-dim); line-height: 1.6; }
        
        /* è¿›åº¦æ¡ */
        .progress-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
        }
        .progress-label { font-size: 0.85rem; width: 80px; }
        .progress-bar {
            flex: 1;
            height: 12px;
            background: var(--bg-hover);
            border-radius: 6px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--purple);
            border-radius: 6px;
        }
        .progress-value { font-size: 0.85rem; color: var(--gold); width: 40px; }
        
        /* è€é»„å†å¤§æ—¥æœŸ */
        .almanac-date {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
        }
        .almanac-day {
            font-size: 4rem;
            font-weight: bold;
            color: var(--gold);
        }
        .almanac-info { flex: 1; }
        .almanac-info .year { font-size: 1.1rem; }
        .almanac-info .week { font-size: 0.95rem; color: var(--text-dim); }
        .almanac-info .lunar { font-size: 0.95rem; color: var(--purple-light); }
        .almanac-info .ganzhi { font-size: 0.9rem; color: var(--gold-dark); }
        
        /* è§£è¯»æ–‡æœ¬ */
        .reading-item {
            padding: 8px 0;
            font-size: 0.9rem;
            line-height: 1.6;
            border-bottom: 1px solid var(--bg-hover);
        }
        .reading-item:last-child { border-bottom: none; }
        
        /* æç¤ºæ–‡å­— */
        .hint-text {
            text-align: center;
            font-size: 0.85rem;
            color: var(--gold);
            padding: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨ -->
        <header class="header">
            <h1>âœ¨ ç„æœºå‘½ç† âœ¨</h1>
            <div class="subtitle">æ´æ‚‰å¤©æœº Â· è¶‹å‰é¿å‡¶</div>
            <div class="date-info" id="dateInfo"></div>
        </header>
        
        <!-- å†…å®¹åŒº -->
        <main class="content">
            <!-- é¦–é¡µ -->
            <div id="page-home" class="page active">
                <div class="feature-grid">
                    <div class="feature-card" onclick="showPage('fortune')">
                        <div class="icon">ğŸ”®</div>
                        <div class="title">ç®—å‘½å¤§å¸ˆ</div>
                        <div class="desc">å…«å­—å‘½ç†åˆ†æ</div>
                    </div>
                    <div class="feature-card" onclick="showPage('auspicious')">
                        <div class="icon">ğŸ“…</div>
                        <div class="title">é»„é“å‰æ—¥</div>
                        <div class="desc">æ‹©å–è‰¯è¾°å‰æ—¥</div>
                    </div>
                    <div class="feature-card" onclick="showPage('almanac')">
                        <div class="icon">ğŸ“œ</div>
                        <div class="title">è€é»„å†</div>
                        <div class="desc">æ¯æ—¥å®œå¿ŒæŸ¥è¯¢</div>
                    </div>
                    <div class="feature-card" onclick="showPage('marriage')">
                        <div class="icon">ğŸ’‘</div>
                        <div class="title">å©šå§»é…å¯¹</div>
                        <div class="desc">ç”Ÿè‚–å§»ç¼˜æµ‹ç®—</div>
                    </div>
                </div>
            </div>
            
            <!-- ç®—å‘½å¤§å¸ˆ -->
            <div id="page-fortune" class="page">
                <div class="card">
                    <div class="card-title">ğŸ”® è¾“å…¥ç”Ÿè¾°å…«å­—</div>
                    <div class="input-group">
                        <select id="birthYear"></select>
                        <span>å¹´</span>
                        <select id="birthMonth"></select>
                        <span>æœˆ</span>
                        <select id="birthDay"></select>
                        <span>æ—¥</span>
                        <select id="birthHour"></select>
                        <span>æ—¶</span>
                    </div>
                    <button class="btn" onclick="calculateFortune()">ğŸ”® å¼€å§‹æµ‹ç®—</button>
                </div>
                <div id="fortuneResult"></div>
            </div>
            
            <!-- é»„é“å‰æ—¥ -->
            <div id="page-auspicious" class="page">
                <div class="card">
                    <div class="card-title">ğŸ“… é€‰æ‹©äº‹é¡¹</div>
                    <div class="input-group">
                        <select id="eventType">
                            <option>ç»“å©šå«å¨¶</option>
                            <option>æ¬å®¶å…¥å®…</option>
                            <option>å¼€ä¸šå¼€å¼ </option>
                            <option>å‡ºè¡Œè¿œè¡Œ</option>
                            <option>ç­¾çº¦äº¤æ˜“</option>
                        </select>
                        <button class="btn btn-green" onclick="searchAuspicious()">ğŸ” æŸ¥è¯¢</button>
                    </div>
                </div>
                <div id="auspiciousResult"></div>
            </div>
            
            <!-- è€é»„å† -->
            <div id="page-almanac" class="page">
                <div class="card" id="almanacContent"></div>
            </div>
            
            <!-- å©šå§»é…å¯¹ -->
            <div id="page-marriage" class="page">
                <div class="card">
                    <div class="card-title">ğŸ’‘ ç”Ÿè‚–é…å¯¹</div>
                    <div class="input-group" style="justify-content: center;">
                        <span>ğŸ‘¨</span>
                        <select id="maleZodiac"></select>
                        <span style="font-size: 1.5rem; color: var(--red);">â¤</span>
                        <select id="femaleZodiac"></select>
                        <span>ğŸ‘©</span>
                    </div>
                    <button class="btn btn-red" onclick="calculateMatch()">ğŸ’• å¼€å§‹é…å¯¹</button>
                </div>
                <div id="matchResult"></div>
            </div>
        </main>
        
        <!-- åº•éƒ¨å¯¼èˆª -->
        <nav class="nav-bar">
            <div class="nav-item active" onclick="showPage('home')">
                <span class="icon">ğŸ </span>
                <span>é¦–é¡µ</span>
            </div>
            <div class="nav-item" onclick="showPage('fortune')">
                <span class="icon">ğŸ”®</span>
                <span>ç®—å‘½</span>
            </div>
            <div class="nav-item" onclick="showPage('auspicious')">
                <span class="icon">ğŸ“…</span>
                <span>å‰æ—¥</span>
            </div>
            <div class="nav-item" onclick="showPage('almanac')">
                <span class="icon">ğŸ“œ</span>
                <span>é»„å†</span>
            </div>
            <div class="nav-item" onclick="showPage('marriage')">
                <span class="icon">ğŸ’‘</span>
                <span>é…å¯¹</span>
            </div>
        </nav>
    </div>

<script>
'use strict';

// ============ å¸¸é‡é…ç½® ============
const CONFIG = {
    TIANGAN: Object.freeze(['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸']),
    DIZHI: Object.freeze(['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥']),
    SHENGXIAO: Object.freeze(['é¼ ', 'ç‰›', 'è™', 'å…”', 'é¾™', 'è›‡', 'é©¬', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—', 'çŒª']),
    WUXING: Object.freeze(['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ']),
    LUNAR_MONTHS: Object.freeze(['æ­£æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'å†¬æœˆ', 'è…Šæœˆ']),
    LUNAR_DAYS: Object.freeze(['åˆä¸€', 'åˆäºŒ', 'åˆä¸‰', 'åˆå››', 'åˆäº”', 'åˆå…­', 'åˆä¸ƒ', 'åˆå…«', 'åˆä¹', 'åˆå',
                      'åä¸€', 'åäºŒ', 'åä¸‰', 'åå››', 'åäº”', 'åå…­', 'åä¸ƒ', 'åå…«', 'åä¹', 'äºŒå',
                      'å»¿ä¸€', 'å»¿äºŒ', 'å»¿ä¸‰', 'å»¿å››', 'å»¿äº”', 'å»¿å…­', 'å»¿ä¸ƒ', 'å»¿å…«', 'å»¿ä¹', 'ä¸‰å']),
    WEEKDAYS: Object.freeze(['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­']),
    // äº”è¡Œç”Ÿå…‹å…³ç³»
    WUXING_SHENG: Object.freeze({æœ¨:'ç«', ç«:'åœŸ', åœŸ:'é‡‘', é‡‘:'æ°´', æ°´:'æœ¨'}),
    WUXING_KE: Object.freeze({æœ¨:'åœŸ', åœŸ:'æ°´', æ°´:'ç«', ç«:'é‡‘', é‡‘:'æœ¨'}),
    // å¤©å¹²äº”è¡Œæ˜ å°„
    GAN_WUXING: Object.freeze({ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'}),
    // åœ°æ”¯äº”è¡Œæ˜ å°„
    ZHI_WUXING: Object.freeze({å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'}),
    // äº”è¡Œæ ·å¼ç±»å
    WUXING_COLORS: Object.freeze({é‡‘:'wuxing-jin', æœ¨:'wuxing-mu', æ°´:'wuxing-shui', ç«:'wuxing-huo', åœŸ:'wuxing-tu'})
};

// å†œå†æ•°æ®
const LUNAR_DATA = {
    2024: [[1,30],[2,30],[3,29],[4,30],[5,29],[6,30],[7,29],[8,30],[9,29],[10,30],[11,29],[12,30]],
    2025: [
        {month: 1, days: 30, leap: false}, {month: 2, days: 29, leap: false},
        {month: 3, days: 30, leap: false}, {month: 4, days: 29, leap: false},
        {month: 5, days: 30, leap: false}, {month: 6, days: 29, leap: false},
        {month: 6, days: 29, leap: true},  // é—°å…­æœˆ
        {month: 7, days: 30, leap: false}, {month: 8, days: 29, leap: false},
        {month: 9, days: 30, leap: false}, {month: 10, days: 30, leap: false},
        {month: 11, days: 29, leap: false}, {month: 12, days: 30, leap: false}
    ],
    baseDate2024: new Date(2024, 1, 10),
    baseDate2025: new Date(2025, 0, 29)
};

// ============ DOMç¼“å­˜ ============
const DOM = {};
function cacheDOM() {
    DOM.dateInfo = document.getElementById('dateInfo');
    DOM.birthYear = document.getElementById('birthYear');
    DOM.birthMonth = document.getElementById('birthMonth');
    DOM.birthDay = document.getElementById('birthDay');
    DOM.birthHour = document.getElementById('birthHour');
    DOM.maleZodiac = document.getElementById('maleZodiac');
    DOM.femaleZodiac = document.getElementById('femaleZodiac');
    DOM.eventType = document.getElementById('eventType');
    DOM.fortuneResult = document.getElementById('fortuneResult');
    DOM.auspiciousResult = document.getElementById('auspiciousResult');
    DOM.almanacContent = document.getElementById('almanacContent');
    DOM.matchResult = document.getElementById('matchResult');
    DOM.pages = document.querySelectorAll('.page');
    DOM.navItems = document.querySelectorAll('.nav-item');
}

// ============ æ¯æ—¥ä¿¡æ¯ï¼ˆåŸºäºä¼ ç»Ÿå‘½ç†å­¦è®¡ç®—ï¼Œç¡®ä¿å„æ¿å—ä¸€è‡´ï¼‰ ============
const DailyInfo = {
    _cache: null,
    _cacheDate: null,
    
    // åœ°æ”¯å…­å†²å…³ç³»ï¼šå­åˆå†²ã€ä¸‘æœªå†²ã€å¯…ç”³å†²ã€å¯é…‰å†²ã€è¾°æˆŒå†²ã€å·³äº¥å†²
    // ç´¢å¼•å¯¹åº”ï¼š0-å­ 1-ä¸‘ 2-å¯… 3-å¯ 4-è¾° 5-å·³ 6-åˆ 7-æœª 8-ç”³ 9-é…‰ 10-æˆŒ 11-äº¥
    CHONG_MAP: [6, 7, 8, 9, 10, 11, 0, 1, 2, 3, 4, 5], // æ—¥æ”¯ç´¢å¼• -> å†²çš„åœ°æ”¯ç´¢å¼•
    
    // ç…æ–¹è§„åˆ™ï¼šç”³å­è¾°æ—¥ç…å—ã€äº¥å¯æœªæ—¥ç…è¥¿ã€å¯…åˆæˆŒæ—¥ç…åŒ—ã€å·³é…‰ä¸‘æ—¥ç…ä¸œ
    SHA_MAP: {
        0: 'å—', 4: 'å—', 8: 'å—',   // å­ã€è¾°ã€ç”³æ—¥ç…å—
        3: 'è¥¿', 7: 'è¥¿', 11: 'è¥¿',  // å¯ã€æœªã€äº¥æ—¥ç…è¥¿
        2: 'åŒ—', 6: 'åŒ—', 10: 'åŒ—',  // å¯…ã€åˆã€æˆŒæ—¥ç…åŒ—
        1: 'ä¸œ', 5: 'ä¸œ', 9: 'ä¸œ'    // ä¸‘ã€å·³ã€é…‰æ—¥ç…ä¸œ
    },
    
    // è®¡ç®—æŸæ—¥çš„æ—¥å¹²æ”¯ï¼ˆåŸºå‡†2024å¹´1æœˆ1æ—¥ä¸ºç”²è¾°æ—¥æ¨ç®—ï¼‰
    getDayGanZhi(date) {
        // åŸºå‡†æ—¥ï¼š2024å¹´1æœˆ1æ—¥æ˜¯ç”²è¾°æ—¥ï¼ˆå¤©å¹²ç´¢å¼•0ï¼Œåœ°æ”¯ç´¢å¼•4ï¼‰
        const baseDate = new Date(2024, 0, 1);
        const baseGanIdx = 0;  // ç”²
        const baseZhiIdx = 4;  // è¾°
        
        // è®¡ç®—ä¸åŸºå‡†æ—¥çš„å¤©æ•°å·®
        const diffDays = Math.floor((date.getTime() - baseDate.getTime()) / (1000 * 60 * 60 * 24));
        
        // å¹²æ”¯å¾ªç¯
        const ganIdx = ((baseGanIdx + diffDays) % 10 + 10) % 10;
        const zhiIdx = ((baseZhiIdx + diffDays) % 12 + 12) % 12;
        
        return {
            gan: CONFIG.TIANGAN[ganIdx],
            zhi: CONFIG.DIZHI[zhiIdx],
            ganIdx: ganIdx,
            zhiIdx: zhiIdx
        };
    },
    
    // è®¡ç®—å‰ç¥ï¼ˆåŸºäºæœˆä»½å’Œæ—¥å¹²ï¼‰
    getJiShen(date, ganIdx) {
        const month = date.getMonth() + 1;
        // å¤©å¾·ï¼šæ­£ä¸ƒåºšã€äºŒå…«è¾›ã€ä¸‰ä¹å£¬ã€å››åç™¸ã€äº”åä¸€ç”²ã€å…­åäºŒä¸™
        const tianDeGan = [6, 7, 8, 9, 0, 2, 6, 7, 8, 9, 0, 2]; // å„æœˆå¤©å¾·å¯¹åº”çš„å¤©å¹²ç´¢å¼•
        const yueDeGan = [8, 0, 2, 4, 6, 8, 0, 2, 4, 6, 8, 0];  // å„æœˆæœˆå¾·å¯¹åº”çš„å¤©å¹²ç´¢å¼•
        
        const jiShenList = [];
        if (ganIdx === tianDeGan[month - 1]) jiShenList.push('å¤©å¾·');
        if (ganIdx === yueDeGan[month - 1]) jiShenList.push('æœˆå¾·');
        if (jiShenList.length === 0) {
            // å…¶ä»–å‰ç¥ç®€åŒ–è®¡ç®—
            const otherJiShen = ['å¤©æ©', 'ç¦æ˜Ÿ', 'æ–‡æ˜Œ', 'é©¿é©¬', 'å¤©å–œ', 'ç‰å ‚'];
            jiShenList.push(otherJiShen[(ganIdx + month) % otherJiShen.length]);
        }
        return jiShenList.join('ã€');
    },
    
    // è®¡ç®—å‡¶ç¥ï¼ˆåŸºäºæ—¥æ”¯ï¼‰
    getXiongShen(zhiIdx) {
        // å‡¶ç¥ä¸æ—¥æ”¯ç›¸å…³ï¼Œç®€åŒ–è®¡ç®—
        const xiongShenList = ['äº”é¬¼', 'æ­»æ°”', 'ç™½è™', 'å¤©åˆ‘', 'æœ±é›€', 'å¤©ç‹—'];
        return xiongShenList[zhiIdx % xiongShenList.length];
    },
    
    get() {
        const today = new Date();
        const dateKey = `${today.getFullYear()}-${today.getMonth()}-${today.getDate()}`;
        
        // ç¼“å­˜å½“å¤©æ•°æ®ï¼Œé¿å…é‡å¤è®¡ç®—
        if (this._cacheDate === dateKey && this._cache) {
            return this._cache;
        }
        
        // è®¡ç®—ä»Šæ—¥å¹²æ”¯
        const dayGZ = this.getDayGanZhi(today);
        
        // æ ¹æ®æ—¥æ”¯è®¡ç®—å†²çš„ç”Ÿè‚–ï¼ˆåœ°æ”¯å…­å†²ï¼‰
        const chongZhiIdx = this.CHONG_MAP[dayGZ.zhiIdx];
        const chongSx = CONFIG.SHENGXIAO[chongZhiIdx];
        
        // æ ¹æ®æ—¥æ”¯è®¡ç®—ç…æ–¹
        const shaDir = this.SHA_MAP[dayGZ.zhiIdx];
        
        // è®¡ç®—å‰ç¥
        const jiShen = this.getJiShen(today, dayGZ.ganIdx);
        
        // è®¡ç®—å‡¶ç¥
        const xiongShen = this.getXiongShen(dayGZ.zhiIdx);
        
        this._cache = {
            dayGan: dayGZ.gan,
            dayZhi: dayGZ.zhi,
            chongSx: chongSx,
            chongZhi: CONFIG.DIZHI[chongZhiIdx],
            shaDir: shaDir,
            jiShen: jiShen,
            xiongShen: xiongShen
        };
        this._cacheDate = dateKey;
        
        return this._cache;
    }
};

// ============ å·¥å…·å‡½æ•° ============
const Utils = {
    // åŸºäºç§å­çš„ç¡®å®šæ€§éšæœºæ•°ç”Ÿæˆï¼ˆä¿è¯åŒæ ·è¾“å…¥åŒæ ·è¾“å‡ºï¼‰
    seededRandom(seed) {
        const x = Math.sin(seed) * 10000;
        return x - Math.floor(x);
    },
    
    // ç¡®å®šæ€§æ•´æ•°ï¼ˆåŸºäºç§å­ï¼‰
    deterministicInt(seed, min, max) {
        return min + Math.floor(this.seededRandom(seed) * (max - min + 1));
    },
    
    // ç¡®å®šæ€§æ‰“ä¹±æ•°ç»„å¹¶å–å‰nä¸ªï¼ˆåŸºäºç§å­ï¼‰
    deterministicSlice(arr, n, seed) {
        const indexed = arr.map((item, i) => ({ item, sort: this.seededRandom(seed + i) }));
        indexed.sort((a, b) => a.sort - b.sort);
        return indexed.slice(0, n).map(x => x.item);
    },
    
    // è®¡ç®—æ—¥æœŸå·®ï¼ˆå¤©æ•°ï¼‰
    daysBetween(date1, date2) {
        return Math.floor((date1 - date2) / (1000 * 60 * 60 * 24));
    },
    // æ·»åŠ å¤©æ•°åˆ°æ—¥æœŸ
    addDays(date, days) {
        return new Date(date.getTime() + days * 24 * 60 * 60 * 1000);
    },
    // å®‰å…¨è·å–å…ƒç´ å€¼
    getSelectValue(element, defaultVal = 0) {
        return element ? parseInt(element.value) || defaultVal : defaultVal;
    },
    // å¡«å……é€‰æ‹©æ¡†é€‰é¡¹
    populateSelect(element, options, valueKey, textKey) {
        if (!element) return;
        const fragment = document.createDocumentFragment();
        options.forEach(opt => {
            const option = document.createElement('option');
            option.value = valueKey ? opt[valueKey] : opt;
            option.textContent = textKey ? opt[textKey] : opt;
            fragment.appendChild(option);
        });
        element.appendChild(fragment);
    },
    // è·å–æ—¥æœŸç§å­ï¼ˆç”¨äºå½“æ—¥ç¡®å®šæ€§è®¡ç®—ï¼‰
    getDateSeed(date) {
        return date.getFullYear() * 10000 + (date.getMonth() + 1) * 100 + date.getDate();
    }
};

// ============ å†œå†è®¡ç®—æ¨¡å— ============
const LunarCalendar = {
    // è·å–å†œå†æ—¥æœŸ
    getDate(date) {
        const year = date.getFullYear();
        if (year === 2025) {
            const offset = Utils.daysBetween(date, LUNAR_DATA.baseDate2025);
            if (offset < 0) return this.getDate2024(date);
            return this._calculateLunar(offset, LUNAR_DATA[2025]);
        }
        if (year === 2024) return this.getDate2024(date);
        return this._getGeneral(date);
    },
    
    // 2024å¹´å†œå†è®¡ç®—
    getDate2024(date) {
        const offset = Utils.daysBetween(date, LUNAR_DATA.baseDate2024);
        if (offset < 0) return this._getGeneral(date);
        
        let dayCount = 0;
        for (const [m, d] of LUNAR_DATA[2024]) {
            if (offset < dayCount + d) {
                return CONFIG.LUNAR_MONTHS[m-1] + CONFIG.LUNAR_DAYS[offset - dayCount];
            }
            dayCount += d;
        }
        return this._getGeneral(date);
    },
    
    // 2025å¹´å†œå†è®¡ç®—ï¼ˆåŒ…å«é—°æœˆï¼‰
    _calculateLunar(offset, lunarData) {
        let dayCount = 0;
        for (let i = 0; i < lunarData.length; i++) {
            if (offset < dayCount + lunarData[i].days) {
                const lunarDay = offset - dayCount + 1;
                let monthStr = CONFIG.LUNAR_MONTHS[lunarData[i].month - 1];
                if (lunarData[i].leap) monthStr = 'é—°' + monthStr;
                return monthStr + CONFIG.LUNAR_DAYS[lunarDay - 1];
            }
            dayCount += lunarData[i].days;
        }
        return CONFIG.LUNAR_MONTHS[0] + CONFIG.LUNAR_DAYS[0];
    },
    
    // é€šç”¨å†œå†è®¡ç®—ï¼ˆè¿‘ä¼¼å€¼ï¼‰
    _getGeneral(date) {
        const m = (date.getMonth() + 11) % 12;
        const d = (date.getDate() + 18) % 30;
        return CONFIG.LUNAR_MONTHS[m] + CONFIG.LUNAR_DAYS[d];
    }
};

// å…¼å®¹æ—§å‡½æ•°å
function getLunarDate(date) { return LunarCalendar.getDate(date); }

// ============ é¡µé¢å¯¼èˆªæ¨¡å— ============
const NAV_INDEX = Object.freeze({home:0, fortune:1, auspicious:2, almanac:3, marriage:4});

function showPage(page) {
    // ä½¿ç”¨ç¼“å­˜çš„DOMå…ƒç´ 
    DOM.pages.forEach(p => p.classList.remove('active'));
    DOM.navItems.forEach(n => n.classList.remove('active'));
    
    const pageEl = document.getElementById('page-' + page);
    if (pageEl) pageEl.classList.add('active');
    
    if (NAV_INDEX[page] !== undefined) {
        DOM.navItems[NAV_INDEX[page]]?.classList.add('active');
    }
    
    // é¡µé¢åŠ è½½å›è°ƒ
    const pageCallbacks = {
        almanac: showAlmanac,
        auspicious: searchAuspicious
    };
    pageCallbacks[page]?.();
}

// ============ åˆå§‹åŒ–æ¨¡å— ============
function init() {
    // ç¼“å­˜DOMå…ƒç´ 
    cacheDOM();
    
    // æ˜¾ç¤ºå½“å‰æ—¥æœŸä¿¡æ¯
    const now = new Date();
    const dateStr = `${now.getFullYear()}å¹´${now.getMonth()+1}æœˆ${now.getDate()}æ—¥ å‘¨${CONFIG.WEEKDAYS[now.getDay()]}`;
    const lunar = getLunarDate(now);
    DOM.dateInfo.innerHTML = `ğŸ“… ${dateStr} â”‚ ğŸŒ™ ${lunar}`;
    
    // åˆå§‹åŒ–ç”Ÿè¾°é€‰æ‹©æ¡†
    initBirthSelectors();
    
    // åˆå§‹åŒ–ç”Ÿè‚–é€‰æ‹©æ¡†
    initZodiacSelectors();
}

function initBirthSelectors() {
    // å¹´ä»½é€‰æ‹©æ¡†
    const years = Array.from({length: 85}, (_, i) => 2024 - i);
    Utils.populateSelect(DOM.birthYear, years);
    DOM.birthYear.value = '1990';
    
    // æœˆä»½é€‰æ‹©æ¡†
    const months = Array.from({length: 12}, (_, i) => i + 1);
    Utils.populateSelect(DOM.birthMonth, months);
    
    // æ—¥æœŸé€‰æ‹©æ¡†
    const days = Array.from({length: 31}, (_, i) => i + 1);
    Utils.populateSelect(DOM.birthDay, days);
    
    // å°æ—¶é€‰æ‹©æ¡†
    const hours = Array.from({length: 24}, (_, i) => i);
    Utils.populateSelect(DOM.birthHour, hours);
    DOM.birthHour.value = '12';
}

function initZodiacSelectors() {
    Utils.populateSelect(DOM.maleZodiac, CONFIG.SHENGXIAO);
    Utils.populateSelect(DOM.femaleZodiac, CONFIG.SHENGXIAO);
    DOM.maleZodiac.value = 'é¾™';
    DOM.femaleZodiac.value = 'å…”';
}

// ============ å…«å­—è®¡ç®—æ¨¡å— ============
const BaziCalculator = {
    // è®¡ç®—å…«å­—
    calculate(year, month, day, hour) {
        const yearGan = CONFIG.TIANGAN[(year - 4) % 10];
        const yearZhi = CONFIG.DIZHI[(year - 4) % 12];
        const sx = CONFIG.SHENGXIAO[(year - 4) % 12];
        
        const monthGan = CONFIG.TIANGAN[(year * 12 + month + 3) % 10];
        const monthZhi = CONFIG.DIZHI[(month + 1) % 12];
        
        const dayGan = CONFIG.TIANGAN[(year * 365 + month * 30 + day) % 10];
        const dayZhi = CONFIG.DIZHI[(year * 365 + month * 30 + day) % 12];
        
        const hourZhiIdx = Math.floor((hour + 1) / 2) % 12;
        const hourGan = CONFIG.TIANGAN[(CONFIG.TIANGAN.indexOf(dayGan) * 2 + hourZhiIdx) % 10];
        const hourZhi = CONFIG.DIZHI[hourZhiIdx];
        
        return { yearGan, yearZhi, monthGan, monthZhi, dayGan, dayZhi, hourGan, hourZhi, sx };
    },
    
    // è®¡ç®—äº”è¡Œåˆ†å¸ƒ
    calculateWuxing(bazi) {
        const {yearGan, monthGan, dayGan, hourGan, yearZhi, monthZhi, dayZhi, hourZhi} = bazi;
        const wxCount = {é‡‘:0, æœ¨:0, æ°´:0, ç«:0, åœŸ:0};
        
        [yearGan, monthGan, dayGan, hourGan].forEach(g => wxCount[CONFIG.GAN_WUXING[g]]++);
        [yearZhi, monthZhi, dayZhi, hourZhi].forEach(z => wxCount[CONFIG.ZHI_WUXING[z]]++);
        
        return wxCount;
    },
    
    // åˆ†ææ—¥ä¸»å¼ºå¼±å’Œå–œå¿Œç¥
    analyzeStrength(dayGan, wxCount) {
        const dayWx = CONFIG.GAN_WUXING[dayGan];
        const shengWo = Object.keys(CONFIG.WUXING_SHENG).find(k => CONFIG.WUXING_SHENG[k] === dayWx);
        const woSheng = CONFIG.WUXING_SHENG[dayWx];
        const keWo = Object.keys(CONFIG.WUXING_KE).find(k => CONFIG.WUXING_KE[k] === dayWx);
        const woKe = CONFIG.WUXING_KE[dayWx];
        
        const helpCount = wxCount[dayWx] + wxCount[shengWo];
        const drainCount = wxCount[woSheng] + wxCount[woKe] + wxCount[keWo];
        const isStrong = helpCount >= drainCount;
        
        const xiShen = isStrong ? [woSheng, woKe] : [dayWx, shengWo];
        const jiShen = isStrong ? [dayWx, shengWo] : [woSheng, woKe];
        
        return { dayWx, isStrong, xiShen, jiShen, shengWo, woSheng, keWo, woKe };
    },
    
    // è·å–æ ¼å±€ï¼ˆåŸºäºå…«å­—ç¡®å®šæ€§è®¡ç®—ï¼‰
    getGeju(bazi) {
        const gejuList = ['æ­£å°æ ¼','åå°æ ¼','é£Ÿç¥æ ¼','ä¼¤å®˜æ ¼','æ­£è´¢æ ¼','åè´¢æ ¼','æ­£å®˜æ ¼','ä¸ƒæ€æ ¼'];
        // åŸºäºæ—¥æŸ±å¹²æ”¯ç¡®å®šæ ¼å±€
        const seed = CONFIG.TIANGAN.indexOf(bazi.dayGan) * 12 + CONFIG.DIZHI.indexOf(bazi.dayZhi);
        return gejuList[seed % gejuList.length];
    }
};

// ============ å‘½ç†è§£è¯»æ•°æ® ============
function getLifeReadings(dayWx, isStrong) {
    const lifeReadings = {
        'æœ¨': {
            true: [
                'ã€ç»¼åˆå‘½è¿ã€‘æ—¥ä¸»ç”²æœ¨èº«æ—ºï¼Œå¦‚å‚å¤©å¤§æ ‘ï¼Œç”Ÿå‘½åŠ›æ—ºç››ã€‚ä¸€ç”Ÿæ€§æ ¼åˆšæ­£ä¸é˜¿ï¼Œæœ‰é¢†å¯¼æ‰èƒ½ï¼Œé€‚åˆæ‹…ä»»ç®¡ç†è€…è§’è‰²ã€‚',
                'ã€å°‘å¹´è¿åŠ¿ã€‘ï¼ˆ1-25å²ï¼‰å°‘å¹´æ—¶æœŸå­¦ä¸šé¡ºåˆ©ï¼Œèªæ˜å¥½å­¦ï¼Œä½†æ€§æ ¼è¾ƒä¸ºå€’å¼ºï¼Œéœ€æ³¨æ„ä¸äººç›¸å¤„çš„æ–¹å¼æ–¹æ³•ã€‚',
                'ã€ä¸­å¹´è¿åŠ¿ã€‘ï¼ˆ26-50å²ï¼‰ä¸­å¹´äº‹ä¸šæœ‰æˆï¼Œè´¢è¿äº¨é€šï¼Œä½†æœ¨æ—ºå…‹åœŸï¼Œéœ€æ³¨æ„å©šå§»å®¶åº­çš„ç»è¥ï¼Œé¿å…å› äº‹ä¸šè€Œå¿½è§†å®¶äººã€‚',
                'ã€æ™šå¹´è¿åŠ¿ã€‘ï¼ˆ51å²åï¼‰æ™šå¹´å®‰åº·ï¼Œå­å­™å­é¡ºï¼Œå¯äº«å¤©ä¼¦ä¹‹ä¹ã€‚æ³¨æ„è‚èƒ†ä¿å…»ï¼Œé€‚å½“è¿åŠ¨ã€‚'
            ],
            false: [
                'ã€ç»¼åˆå‘½è¿ã€‘æ—¥ä¸»ç”²æœ¨èº«å¼±ï¼Œå¦‚å¹¼è‹—éœ€æ°´æœ¨æ»‹å…»ã€‚ä¸€ç”Ÿæ€§æ ¼æ¸©å’Œï¼Œå–„äºåˆä½œï¼Œé€‚åˆå›¢é˜Ÿå·¥ä½œï¼Œå€ŸåŠ©è´µäººä¹‹åŠ›å‘å±•ã€‚',
                'ã€å°‘å¹´è¿åŠ¿ã€‘ï¼ˆ1-25å²ï¼‰å°‘å¹´æ—¶æœŸå¯èƒ½è¾ƒä¸ºè‰°è‹¦ï¼Œéœ€è¦åŠªåŠ›å­¦ä¹ ï¼Œå¤šä¾é çˆ¶æ¯å¸®åŠ©ã€‚',
                'ã€ä¸­å¹´è¿åŠ¿ã€‘ï¼ˆ26-50å²ï¼‰ä¸­å¹´è¿åŠ¿æ¸å…¥ä½³å¢ƒï¼Œé‡è´µäººç›¸åŠ©ï¼Œäº‹ä¸šæœ‰æˆã€‚å©šå§»ç¼˜åˆ†æ¥å¾—ç¨æ™šï¼Œä½†è´¨é‡é«˜ã€‚',
                'ã€æ™šå¹´è¿åŠ¿ã€‘ï¼ˆ51å²åï¼‰æ™šå¹´å­å­™å­é¡ºï¼Œå¤§å™¨æ™šæˆï¼Œå¯äº«æ¸…ç¦ã€‚æ³¨æ„è‚èƒ†ã€ç­‹éª¨ä¿å…»ã€‚'
            ]
        },
        'ç«': {
            true: [
                'ã€ç»¼åˆå‘½è¿ã€‘æ—¥ä¸»ä¸™ç«èº«æ—ºï¼Œå¦‚æ—¥ä¸­å¤©ï¼Œå…‰æ˜ç£Šè½ï¼Œçƒ­æƒ…å¼€æœ—ã€‚å…·æœ‰é¢†è¢–æ°”è´¨ï¼Œäº‹ä¸šå¿ƒå¼ºï¼Œå¹´è½»æ—¶å³æœ‰æˆå°±ã€‚',
                'ã€å°‘å¹´è¿åŠ¿ã€‘ï¼ˆ1-25å²ï¼‰å°‘å¹´æ—¶æœŸæ´»æ³¼å¥½åŠ¨ï¼Œå­¦ä¸šè¡¨ç°çªå‡ºï¼Œä½†æ€§æ ¼æ€¥èºï¼Œéœ€ä¿®èº«å…»æ€§ã€‚',
                'ã€ä¸­å¹´è¿åŠ¿ã€‘ï¼ˆ26-50å²ï¼‰ä¸­å¹´äº‹ä¸šè¾¾é«˜å³°ï¼Œååˆ©åŒæ”¶ã€‚ä½†ç«æ—ºåˆ™ç‡¥ï¼Œéœ€æ°´æ¥æµï¼Œå®œå¤šä¸æ°´å‹äººåˆä½œã€‚',
                'ã€æ™šå¹´è¿åŠ¿ã€‘ï¼ˆ51å²åï¼‰æ™šå¹´å­å­™æœ‰å‡ºæ¯ï¼Œå®¶åº­å’Œç¦ã€‚æ³¨æ„å¿ƒè¡€ç®¡ä¿å…»ï¼Œå¿Œæš´èºã€‚'
            ],
            false: [
                'ã€ç»¼åˆå‘½è¿ã€‘æ—¥ä¸»ä¸™ç«èº«å¼±ï¼Œå¦‚çƒ›ç«å¾®å¼±ï¼Œéœ€æœ¨æ¥ç”Ÿæ‰¶ã€‚æ€§æ ¼æ¸©å’Œï¼Œå–„äºäº¤é™…ï¼Œäººç¼˜æä½³ã€‚',
                'ã€å°‘å¹´è¿åŠ¿ã€‘ï¼ˆ1-25å²ï¼‰å°‘å¹´æ—¶æœŸéœ€è´µäººææºï¼Œä¾é å®¶åº­æ‰¶æŒï¼Œå­¦ä¸šå¹³ç¨³ã€‚',
                'ã€ä¸­å¹´è¿åŠ¿ã€‘ï¼ˆ26-50å²ï¼‰ä¸­å¹´è¿åŠ¿æ¸ä½³ï¼Œé€‚åˆå…¬å…³ã€é”€å”®ç±»å·¥ä½œã€‚è´¢è¿å¹³ç¨³ï¼Œä¸å®œå†’é™©æŠ•èµ„ã€‚',
                'ã€æ™šå¹´è¿åŠ¿ã€‘ï¼ˆ51å²åï¼‰æ™šå¹´å­å­™ç¼˜æ·±ï¼Œå®¶åº­å¹¸ç¦ã€‚æ³¨æ„å¿ƒè„ã€è¡€å‹ä¿å…»ã€‚'
            ]
        },
        'åœŸ': {
            true: [
                'ã€ç»¼åˆå‘½è¿ã€‘æ—¥ä¸»æˆŠåœŸèº«æ—ºï¼Œå¦‚å±±å²³ç¨³é‡ï¼Œè¯šå®å®ˆä¿¡ï¼Œæœ‰æ‹…å½“ã€‚ä½†è¿‡äºå›ºæ‰§ï¼Œéœ€æ³¨æ„çµæ´»å˜é€šã€‚',
                'ã€å°‘å¹´è¿åŠ¿ã€‘ï¼ˆ1-25å²ï¼‰å°‘å¹´æ—¶æœŸæ€§æ ¼è¸å®ï¼Œå­¦ä¸šç¨³å®šï¼Œä½†ä¸å¤Ÿçµæ´»ï¼Œéœ€å¤šæ‹“å±•è§†é‡ã€‚',
                'ã€ä¸­å¹´è¿åŠ¿ã€‘ï¼ˆ26-50å²ï¼‰ä¸­å¹´äº‹ä¸šç¨³å®šï¼Œé€‚åˆæ”¿åºœã€å›½ä¼ã€æ•™è‚²ç­‰è¡Œä¸šã€‚è´¢è¿ç¨³å¥ï¼Œç§¯è“„æ¸ä¸°ã€‚',
                'ã€æ™šå¹´è¿åŠ¿ã€‘ï¼ˆ51å²åï¼‰æ™šå¹´å®‰ç¨³ï¼Œå­å­™å­é¡ºï¼Œå®¶ä¸šå…´æ—ºã€‚æ³¨æ„è„¾èƒƒä¿å…»ã€‚'
            ],
            false: [
                'ã€ç»¼åˆå‘½è¿ã€‘æ—¥ä¸»æˆŠåœŸèº«å¼±ï¼Œå¦‚ç”°å›­ä¹æ°´ï¼Œéœ€ç«åœŸç”Ÿæ‰¶ã€‚æ€§æ ¼éšå’Œï¼ŒåŒ…å®¹æ€§å¼ºï¼Œäººç¼˜å¥½ã€‚',
                'ã€å°‘å¹´è¿åŠ¿ã€‘ï¼ˆ1-25å²ï¼‰å°‘å¹´æ—¶æœŸéœ€ä¾é å®¶åº­ï¼Œå­¦ä¸šè¾ƒä¸ºå¹³å¸¸ï¼Œä½†èƒ½åƒè‹¦è€åŠ³ã€‚',
                'ã€ä¸­å¹´è¿åŠ¿ã€‘ï¼ˆ26-50å²ï¼‰ä¸­å¹´åè¿åŠ¿æ¸å…¥ä½³å¢ƒï¼Œå¤§å™¨æ™šæˆã€‚é€‚åˆç¨³å®šçš„å·¥ä½œç¯å¢ƒã€‚',
                'ã€æ™šå¹´è¿åŠ¿ã€‘ï¼ˆ51å²åï¼‰æ™šå¹´ç¦æ³½æ·±åšï¼Œå­å­™æ»¡å ‚ï¼Œå®¶åº„å’Œç¦ã€‚æ³¨æ„è‚ èƒƒä¿å…»ã€‚'
            ]
        },
        'é‡‘': {
            true: [
                'ã€ç»¼åˆå‘½è¿ã€‘æ—¥ä¸»åºšé‡‘èº«æ—ºï¼Œå¦‚åˆƒå‰‘å‡ºé˜ï¼Œæœæ–­åˆšæ¯…ã€‚é€‚åˆæ­¦èŒã€æ³•å¾‹ã€é‡‘èç­‰è¡Œä¸šã€‚',
                'ã€å°‘å¹´è¿åŠ¿ã€‘ï¼ˆ1-25å²ï¼‰å°‘å¹´æ—¶æœŸæ€§æ ¼è¦å¼ºï¼Œå­¦ä¸šè¡¨ç°çªå‡ºï¼Œä½†éœ€æ³¨æ„äººé™…å…³ç³»ã€‚',
                'ã€ä¸­å¹´è¿åŠ¿ã€‘ï¼ˆ26-50å²ï¼‰ä¸­å¹´äº‹ä¸šæœ‰æˆï¼Œæ­£è´¢è¿ä½³ã€‚ä½†é‡‘æ—ºå…‹æœ¨å¤ªè¿‡ï¼Œå®œæ³¨æ„å®¶åº­å’Œè°ã€‚',
                'ã€æ™šå¹´è¿åŠ¿ã€‘ï¼ˆ51å²åï¼‰æ™šå¹´å®‰åº·ï¼Œå­å­™å­é¡ºã€‚æ³¨æ„è‚ºéƒ¨ã€å‘¼å¸ç³»ç»Ÿä¿å…»ã€‚'
            ],
            false: [
                'ã€ç»¼åˆå‘½è¿ã€‘æ—¥ä¸»åºšé‡‘èº«å¼±ï¼Œå¦‚é¥°å“å°å·§ï¼Œéœ€åœŸé‡‘ç”Ÿæ‰¶ã€‚å¿ƒæ€ç»†å¯†ï¼Œå–„äºç­–åˆ’ï¼Œé€‚åˆå¹•åå·¥ä½œã€‚',
                'ã€å°‘å¹´è¿åŠ¿ã€‘ï¼ˆ1-25å²ï¼‰å°‘å¹´æ—¶æœŸéœ€ä¾é å®¶åº­æ‰¶æŒï¼Œå­¦ä¸šå¹³ç¨³ï¼Œå–„äºæ€è€ƒã€‚',
                'ã€ä¸­å¹´è¿åŠ¿ã€‘ï¼ˆ26-50å²ï¼‰ä¸­å¹´è¿åŠ¿æ¸ä½³ï¼Œé€‚åˆæŠ€æœ¯ã€ç®¡ç†å²—ä½ã€‚è´¢è¿éœ€è€å¿ƒç»è¥ï¼Œç¨³ä¸­æ±‚è¿›ã€‚',
                'ã€æ™šå¹´è¿åŠ¿ã€‘ï¼ˆ51å²åï¼‰æ™šå¹´å­å­™ç¼˜æ·±ï¼Œå®¶åº­å’Œç¦ã€‚æ³¨æ„è‚ºéƒ¨ã€çš®è‚¤ä¿å…»ã€‚'
            ]
        },
        'æ°´': {
            true: [
                'ã€ç»¼åˆå‘½è¿ã€‘æ—¥ä¸»å£¬æ°´èº«æ—ºï¼Œå¦‚æ±Ÿæ²³æ±¹æ¶Œï¼Œæ™ºæ…§è¿‡äººï¼Œå˜é€šèƒ½åŠ›å¼ºã€‚é€‚åˆç ”ç©¶ã€å†™ä½œã€å’¨è¯¢ç­‰æ™ºåŠ›å·¥ä½œã€‚',
                'ã€å°‘å¹´è¿åŠ¿ã€‘ï¼ˆ1-25å²ï¼‰å°‘å¹´æ—¶æœŸèªæ˜è¿‡äººï¼Œå­¦ä¸šä¼˜å¼‚ï¼Œä½†æ€ç»ªä¸å®šï¼Œéœ€ä¸“æ³¨ã€‚',
                'ã€ä¸­å¹´è¿åŠ¿ã€‘ï¼ˆ26-50å²ï¼‰ä¸­å¹´äº‹ä¸šæœ‰æˆï¼Œæœ‰æµ·å¤–å‘å±•è¿ã€‚ä½†æ°´æ—ºåˆ™æ³›ï¼Œéœ€åœŸæ¥åˆ¶ï¼Œå®œä¸åœŸå‹äººåˆä½œã€‚',
                'ã€æ™šå¹´è¿åŠ¿ã€‘ï¼ˆ51å²åï¼‰æ™šå¹´æ™ºæ…§ä¸å‡ï¼Œå¯å‘æŒ¥ä½™çƒ­ã€‚æ³¨æ„è‚¾è„ã€æ³°å°¿ç³»ç»Ÿä¿å…»ã€‚'
            ],
            false: [
                'ã€ç»¼åˆå‘½è¿ã€‘æ—¥ä¸»å£¬æ°´èº«å¼±ï¼Œå¦‚æºå¤´ç»†æµï¼Œéœ€é‡‘æ°´ç”Ÿæ‰¶ã€‚æ€§æ ¼æ¸©é¡ºï¼Œé€‚åº”åŠ›å¼ºï¼Œäººç¼˜å¥½ã€‚',
                'ã€å°‘å¹´è¿åŠ¿ã€‘ï¼ˆ1-25å²ï¼‰å°‘å¹´æ—¶æœŸéœ€å®¶åº­æ‰¶æŒï¼Œå­¦ä¸šå¹³ç¨³ï¼Œä½†å–„äºé€‚åº”ç¯å¢ƒã€‚',
                'ã€ä¸­å¹´è¿åŠ¿ã€‘ï¼ˆ26-50å²ï¼‰ä¸­å¹´è¿åŠ¿æ¸ä½³ï¼Œéœ€è´µäººææºï¼Œåˆä½œç»è¥ä¸ºä½³ã€‚å©šå§»å’Œç¾ã€‚',
                'ã€æ™šå¹´è¿åŠ¿ã€‘ï¼ˆ51å²åï¼‰æ™šå¹´å­å­™ç¼˜æ·±ï¼Œå®¶åº­å¹¸ç¦ã€‚æ³¨æ„è‚¾è„ã€æ³¨æ„ä¿æš–ã€‚'
            ]
        }
    };
    return lifeReadings[dayWx] ? lifeReadings[dayWx][isStrong] : lifeReadings['æœ¨'][true];
}

function calculateFortune() {
    const year = Utils.getSelectValue(DOM.birthYear);
    const month = Utils.getSelectValue(DOM.birthMonth);
    const day = Utils.getSelectValue(DOM.birthDay);
    const hour = Utils.getSelectValue(DOM.birthHour);
    
    // ä½¿ç”¨å…«å­—è®¡ç®—æ¨¡å—
    const bazi = BaziCalculator.calculate(year, month, day, hour);
    const {yearGan, yearZhi, monthGan, monthZhi, dayGan, dayZhi, hourGan, hourZhi, sx} = bazi;
    
    const wxCount = BaziCalculator.calculateWuxing(bazi);
    const analysis = BaziCalculator.analyzeStrength(dayGan, wxCount);
    const {dayWx, isStrong, xiShen, jiShen} = analysis;
    const geju = BaziCalculator.getGeju(bazi);
    
    // å‘½ç†è§£è¯»
    const readings = {
        æœ¨: {true: ['æ—¥ä¸»ç”²æœ¨èº«æ—ºï¼Œå¦‚å‚å¤©å¤§æ ‘ï¼Œåˆšæ­£ä¸é˜¿ï¼Œé¢†å¯¼åŠ›å¼ºã€‚','æœ¨æ—ºå–œé‡‘æ¥é›•ç¢ï¼Œæ–¹èƒ½æˆå™¨ï¼Œå®œä»äº‹çºªå¾‹æ€§å¼ºçš„å·¥ä½œã€‚','è´¢è¿æ–¹é¢ï¼Œä¸­å¹´åè´¢åº“æ¸ä¸°ã€‚'],
             false: ['æ—¥ä¸»ç”²æœ¨èº«å¼±ï¼Œå¦‚å¹¼è‹—æ— ä¾ï¼Œéœ€å¾—æ°´æœ¨ç”Ÿæ‰¶ã€‚','é€‚åˆå›¢é˜Ÿåˆä½œï¼Œå€ŸåŠ©è´µäººä¹‹åŠ›å‘å±•ã€‚','å©šå§»ç¼˜åˆ†æ¥å¾—è¾ƒæ™šï¼Œä½†è´¨é‡é«˜ã€‚']},
        ç«: {true: ['æ—¥ä¸»ä¸™ç«èº«æ—ºï¼Œå¦‚æ—¥ä¸­å¤©ï¼Œå…‰æ˜ç£Šè½ï¼Œæœ‰é¢†è¢–æ°”è´¨ã€‚','ç«æ—ºåˆ™ç‡¥ï¼Œéœ€æ°´æ¥æµï¼Œå®œä¿®èº«å…»æ€§ã€‚','äº‹ä¸šè¿ä½³ï¼Œå¹´è½»æ—¶å³æœ‰æˆå°±ã€‚'],
             false: ['æ—¥ä¸»ä¸™ç«èº«å¼±ï¼Œå¦‚çƒ›ç«å¾®å¼±ï¼Œéœ€æœ¨æ¥ç”Ÿæ‰¶ã€‚','æ€§æ ¼æ¸©å’Œï¼Œå–„äºäº¤é™…ï¼Œäººç¼˜æä½³ã€‚','è´¢è¿å¹³ç¨³ï¼Œä¸å®œå†’é™©æŠ•èµ„ã€‚']},
        åœŸ: {true: ['æ—¥ä¸»æˆŠåœŸèº«æ—ºï¼Œå¦‚å±±å²³ç¨³é‡ï¼Œè¯šå®å®ˆä¿¡ï¼Œæœ‰æ‹…å½“ã€‚','åœŸæ—ºå–œæœ¨æ¥ç–ï¼Œå¦åˆ™è¿‡äºä¿å®ˆã€‚','é€‚åˆç¨³å®šçš„å·¥ä½œç¯å¢ƒã€‚'],
             false: ['æ—¥ä¸»æˆŠåœŸèº«å¼±ï¼Œå¦‚ç”°å›­ä¹æ°´ï¼Œéœ€ç«åœŸç”Ÿæ‰¶ã€‚','æ€§æ ¼éšå’Œï¼ŒåŒ…å®¹æ€§å¼ºï¼Œäººç¼˜å¥½ã€‚','ä¸­å¹´åè¿åŠ¿æ¸å…¥ä½³å¢ƒï¼Œå¤§å™¨æ™šæˆã€‚']},
        é‡‘: {true: ['æ—¥ä¸»åºšé‡‘èº«æ—ºï¼Œå¦‚åˆƒå‰‘å‡ºé˜ï¼Œæœæ–­åˆšæ¯…ã€‚','é‡‘æ—ºå…‹æœ¨å¤ªè¿‡ï¼Œå®œæ³¨æ„äººé™…å…³ç³»ã€‚','æ­¦èŒã€æ³•å¾‹ã€é‡‘èè¡Œä¸šå‘å±•ä½³ã€‚'],
             false: ['æ—¥ä¸»åºšé‡‘èº«å¼±ï¼Œå¦‚é¥°å“å°å·§ï¼Œéœ€åœŸé‡‘ç”Ÿæ‰¶ã€‚','å¿ƒæ€ç»†å¯†ï¼Œå–„äºç­–åˆ’ï¼Œé€‚åˆå¹•åå·¥ä½œã€‚','è´¢è¿éœ€è€å¿ƒç»è¥ï¼Œç¨³ä¸­æ±‚è¿›ã€‚']},
        æ°´: {true: ['æ—¥ä¸»å£¬æ°´èº«æ—ºï¼Œå¦‚æ±Ÿæ²³æ±¹æ¶Œï¼Œæ™ºæ…§è¿‡äººã€‚','æ°´æ—ºåˆ™æ³›ï¼Œéœ€åœŸæ¥åˆ¶ï¼Œå¦åˆ™æ€ç»ªä¸å®šã€‚','é€‚åˆæ™ºåŠ›å·¥ä½œï¼Œæœ‰æµ·å¤–å‘å±•è¿ã€‚'],
             false: ['æ—¥ä¸»å£¬æ°´èº«å¼±ï¼Œå¦‚æºå¤´ç»†æµï¼Œéœ€é‡‘æ°´ç”Ÿæ‰¶ã€‚','æ€§æ ¼æ¸©é¡ºï¼Œé€‚åº”åŠ›å¼ºï¼Œå©šå§»å’Œç¾ã€‚','è´¢è¿éœ€è´µäººææºï¼Œåˆä½œç»è¥ä¸ºä½³ã€‚']}
    };
    const myReadings = readings[dayWx] ? readings[dayWx][isStrong] : readings['æœ¨'][true];
    
    // æµå¹´è¿åŠ¿
    const curYear = new Date().getFullYear();
    const yearGz = CONFIG.TIANGAN[(curYear-4)%10] + CONFIG.DIZHI[(curYear-4)%12] + 'å¹´';
    const yearWx = CONFIG.GAN_WUXING[CONFIG.TIANGAN[(curYear-4)%10]];
    let yearLuck = 'å¹³å¸¸', luckColor = 'var(--orange)';
    let yearSummary, yearDetails;
    if (xiShen.includes(yearWx)) {
        yearLuck = 'å¤§å‰';
        luckColor = 'var(--gold)';
        yearSummary = 'æµå¹´ä¸ºå–œç”¨ç¥ï¼Œè¯¸äº‹é¡ºé‚ï¼Œå¯ç§¯æè¿›å–ã€‚';
        yearDetails = [
            'ğŸ’° è´¢è¿ï¼šè´¢è¿äº¨é€šï¼Œæ­£è´¢åè´¢çš†æœ‰æœºä¼šï¼Œå¯é€‚å½“æŠ•èµ„ç†è´¢ï¼Œä½†ä¸å®œè´ªå¿ƒã€‚',
            'ğŸ¢ äº‹ä¸šï¼šå·¥ä½œé¡ºåˆ©ï¼Œæœ‰è´µäººç›¸åŠ©ï¼Œé€‚åˆæ‹“å±•ä¸šåŠ¡æˆ–è°‹æ±‚æ™‹å‡ã€‚',
            'ğŸ’— æ„Ÿæƒ…ï¼šå•èº«è€…æœ‰æœ›é‡è‰¯ç¼˜ï¼Œå·²å©šè€…æ„Ÿæƒ…å’Œç¦ï¼Œå®¶åº­ç¾æ»¡ã€‚',
            'ğŸ¯ å¥åº·ï¼šèº«ä½“çŠ¶å†µè‰¯å¥½ï¼Œä½†ä»éœ€æ³¨æ„ä½œæ¯è§„å¾‹ï¼Œå‹¿è¿‡åº¦åŠ³ç´¯ã€‚'
        ];
    } else if (yearWx === dayWx) {
        yearLuck = 'å¹³ç¨³';
        luckColor = 'var(--green)';
        yearSummary = 'æµå¹´ä¸æ—¥ä¸»åŒå…ƒï¼Œè¿åŠ¿å¹³ç¨³ï¼Œå®œå®ˆä¸å®œæ”»ã€‚';
        yearDetails = [
            'ğŸ’° è´¢è¿ï¼šæ”¶å…¥ç¨³å®šï¼Œæ­£è´¢ä¸ºä¸»ï¼Œä¸å®œæŠ•æœºå†’é™©ï¼Œç¨³å¥ç†è´¢ä¸ºå®œã€‚',
            'ğŸ¢ äº‹ä¸šï¼šå·¥ä½œæŒ‰éƒ¨å°±ç­ï¼Œä¸å®œè´¸ç„¶è·³æ§½æˆ–åˆ›ä¸šï¼Œå®ˆä½æœ¬èŒä¸ºä¸Šã€‚',
            'ğŸ’— æ„Ÿæƒ…ï¼šæ„Ÿæƒ…å¹³æ·¡ï¼Œéœ€ç”¨å¿ƒç»è¥ï¼Œå¤šä¸ä¼´ä¾£æ²Ÿé€šäº¤æµã€‚',
            'ğŸ¯ å¥åº·ï¼šæ³¨æ„è‚ èƒƒä¿å…»ï¼Œé¥®é£Ÿå®œæ¸…æ·¡ï¼Œä¿æŒé€‚å½“è¿åŠ¨ã€‚'
        ];
    } else {
        yearLuck = 'å¹³å¸¸';
        luckColor = 'var(--orange)';
        yearSummary = 'æµå¹´ä¸å‘½å±€æœ‰å†²ï¼Œå®œè°¨æ…è¡Œäº‹ï¼Œé¿å…é‡å¤§å†³ç­–ã€‚';
        yearDetails = [
            'ğŸ’° è´¢è¿ï¼šè´¢è¿æ³¢åŠ¨ï¼Œå¿Œè´ªå¿ŒæŠ•æœºï¼Œå®ˆä½ç°æœ‰é’±è´¢ï¼Œå‹¿è½»ä¿¡ä»–äººã€‚',
            'ğŸ¢ äº‹ä¸šï¼šå·¥ä½œä¸­å¯èƒ½é‡åˆ°å°äººæˆ–é˜»ç¢ï¼Œå®œä½è°ƒåšäº‹ï¼Œä¸äº‰é£å¤´ã€‚',
            'ğŸ’— æ„Ÿæƒ…ï¼šæ„Ÿæƒ…æ˜“æœ‰æ³¢æŠ˜ï¼Œå¤šåŒ…å®¹ç†è§£ï¼Œé¿å…äº‰åµã€‚',
            'ğŸ¯ å¥åº·ï¼šæ³¨æ„å®‰å…¨ï¼Œè°¨é˜²æ„å¤–ï¼Œå®šæœŸä½“æ£€ï¼Œé¢„é˜²ä¸ºä¸»ã€‚'
        ];
    }
    
    // æ¸²æŸ“ç»“æœ
    const wxColors = CONFIG.WUXING_COLORS;
    
    let html = `
        <div class="card">
            <div class="card-title">ğŸ“¿ å‘½ç†åˆ†ææŠ¥å‘Š</div>
            <div style="text-align:center; margin-bottom:10px;">
                <span style="color:var(--purple-light)">ğŸ² ${sx}å¹´ç”Ÿäºº</span>
                <span style="margin-left:15px; color:var(--gold-dark)">${geju}</span>
            </div>
            
            <div class="card-title">â‘  å…«å­—å‘½ç›˜</div>
            <div class="bazi-row">
                <div class="bazi-col"><div class="label">å¹´æŸ±</div><div class="value">${yearGan}${yearZhi}</div></div>
                <div class="bazi-col"><div class="label">æœˆæŸ±</div><div class="value">${monthGan}${monthZhi}</div></div>
                <div class="bazi-col"><div class="label">æ—¥æŸ±</div><div class="value">${dayGan}${dayZhi}</div></div>
                <div class="bazi-col"><div class="label">æ—¶æŸ±</div><div class="value">${hourGan}${hourZhi}</div></div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">â‘¡ äº”è¡Œåˆ†å¸ƒ</div>
            <div class="wuxing-tags">
                ${Object.entries(wxCount).map(([wx,c]) => {
                    const status = c >= 3 ? 'æ—º' : c >= 1 ? 'å¹³' : 'å¼±';
                    return `<span class="wuxing-tag ${wxColors[wx]}">${wx}:${c}${status}</span>`;
                }).join('')}
            </div>
            <div style="text-align:center; margin-top:10px;">
                <span>æ—¥ä¸»ï¼š${dayGan}${dayWx}</span>
                <span style="margin-left:15px; color:${isStrong?'var(--green)':'var(--orange)'}; font-weight:bold;">
                    ${isStrong ? 'èº«æ—º' : 'èº«å¼±'}
                </span>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">â‘¢ å–œç”¨ç¥ä¸å¿Œç¥</div>
            <div style="display:flex; gap:20px; justify-content:center;">
                <div>âœ… å–œç”¨ï¼š${xiShen.map(x => `<span class="wuxing-tag ${wxColors[x]}">${x}</span>`).join(' ')}</div>
                <div>âŒ å¿Œç¥ï¼š${jiShen.map(x => `<span class="wuxing-tag ${wxColors[x]}">${x}</span>`).join(' ')}</div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">â‘£ å‘½ç†ç»¼åˆè§£è¯»</div>
            ${myReadings.map(r => `<div class="reading-item">â— ${r}</div>`).join('')}
        </div>
        
        <div class="card">
            <div class="card-title">â‘¤ æµå¹´è¿åŠ¿åˆ†æ</div>
            <div style="text-align:center;">
                <div style="font-size:1.1rem;">ğŸ“… ${yearGz}ï¼ˆ${yearWx}ï¼‰ï¼š<span style="color:${luckColor}; font-weight:bold;">${yearLuck}</span></div>
                <div style="font-size:0.9rem; color:var(--text-dim); margin:8px 0;">${yearSummary}</div>
            </div>
            <div style="text-align:left; padding:10px 5px;">
                ${yearDetails.map(d => `<div style="padding:5px 0; font-size:0.85rem;">â— ${d}</div>`).join('')}
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">â‘¥ ä¸€ç”Ÿå‘½è¿æ¦‚è¿°</div>
            <div style="font-size:0.85rem; color:var(--purple-light); padding:5px 0;">æ‚¨çš„æ—¥ä¸»ä¸º${dayGan}ï¼ˆå±${dayWx}ï¼‰ï¼Œ${isStrong ? 'èº«æ—º' : 'èº«å¼±'}ï¼Œå–œç”¨ç¥ä¸º${xiShen.join('ã€')}ï¼Œå¿Œç¥ä¸º${jiShen.join('ã€')}ã€‚</div>
            ${getLifeReadings(dayWx, isStrong).map(r => `<div class="reading-item">â— ${r}</div>`).join('')}
            <div style="font-size:0.8rem; color:var(--text-dim); margin-top:10px;">ğŸ“š å‘½ç†ä¾æ®ï¼šæœ¬åˆ†æåŸºäºã€Šæ¸Šæµ·å­å¹³ã€‹ã€Šä¸‰å‘½é€šä¼šã€‹ã€Šå­å¹³çœŸè¯ ã€‹ç­‰å¤å…¸å‘½ç†å…¸ç±ï¼Œç»“åˆæ—¥ä¸»äº”è¡Œæ—ºè¡°ã€å–œå¿Œç¥ç­‰å› ç´ ç»¼åˆåˆ†æã€‚</div>
        </div>
        
        <div class="hint-text">âœ¨ å‘½ç”±å¤©å®šï¼Œè¿ç”±å·±é€ ï¼Œä»¥ä¸Šä»…ä¾›å‚è€ƒ âœ¨</div>
    `;
    
    DOM.fortuneResult.innerHTML = html;
}

// ============ é»„é“å‰æ—¥æŸ¥è¯¢ ============
function searchAuspicious() {
    const event = DOM.eventType?.value || 'ç»“å©šå«å¨¶';
    const now = new Date();
    const baseSeed = Utils.getDateSeed(now);
    
    // äº‹é¡¹ç±»å‹ç´¢å¼•ï¼ˆç”¨äºç¡®å®šæ€§è®¡ç®—ï¼‰
    const eventTypes = ['ç»“å©šå«å¨¶', 'æ¬å®¶å…¥å®…', 'å¼€ä¸šå¼€å¼ ', 'å‡ºè¡Œè¿œè¡Œ', 'ç­¾çº¦äº¤æ˜“'];
    const eventIdx = eventTypes.indexOf(event) >= 0 ? eventTypes.indexOf(event) : 0;
    
    let html = `<div class="card"><div class="card-title">ğŸ“… è¿‘æœŸã€Œ${event}ã€å‰æ—¥</div>`;
    
    for (let i = 0; i < 10; i++) {
        // åŸºäºæ—¥æœŸã€äº‹é¡¹å’Œåºå·ç¡®å®šæ€§è®¡ç®—å¤©æ•°
        const seed = baseSeed + eventIdx * 100 + i * 7;
        const daysAdd = 3 + i * 7 + Utils.deterministicInt(seed, 0, 4);
        const luckyDate = Utils.addDays(now, daysAdd);
        const dateStr = `${luckyDate.getMonth()+1}æœˆ${luckyDate.getDate()}æ—¥ å‘¨${CONFIG.WEEKDAYS[luckyDate.getDay()]}`;
        const lunar = getLunarDate(luckyDate);
        const levels = ['â˜…â˜…â˜…â˜…â˜… å¤§å‰', 'â˜…â˜…â˜…â˜…â˜† ä¸Šå‰', 'â˜…â˜…â˜…â˜†â˜† ä¸­å‰'];
        const level = levels[Utils.deterministicInt(seed + 1000, 0, 2)];
        
        html += `
            <div class="lucky-day-item">
                <div>
                    <div class="date">ğŸ“† ${dateStr}</div>
                    <div class="lunar">${lunar}</div>
                </div>
                <div class="level">${level}</div>
            </div>
        `;
    }
    
    html += '</div>';
    DOM.auspiciousResult.innerHTML = html;
}

// ============ è€é»„å† ============
const YI_EXPLANATIONS = {
    'å«å¨¶': 'ã€å«å¨¶ã€‘ä»Šæ—¥é€‚åˆä¸¾åŠå©šç¤¼ã€è®¢å©šã€æäº²ç­‰å–œäº‹ã€‚é€‰æ‹©æ­¤æ—¥æˆå©šï¼Œå¤«å¦»å’Œç¦ï¼Œç™½å¤´å•è€ã€‚',
    'ç¥­ç¥€': 'ã€ç¥­ç¥€ã€‘ä»Šæ—¥é€‚åˆç¥­æ‹œç¥æ˜ã€ç¥–å…ˆã€ä¸Šé¦™è¿›è´¡ã€‚è¯šå¿ƒç¥­æ‹œï¼Œå¯ä¿å®¶å®…å¹³å®‰ã€‚',
    'å‡ºè¡Œ': 'ã€å‡ºè¡Œã€‘ä»Šæ—¥é€‚åˆå¤–å‡ºã€æ—…æ¸¸ã€å‡ºå·®ã€æ¢äº²è®¿å‹ã€‚è·¯é€”å¹³å®‰é¡ºåˆ©ã€‚',
    'å¼€å¸‚': 'ã€å¼€å¸‚ã€‘ä»Šæ—¥é€‚åˆåº—é“ºå¼€ä¸šã€å…¬å¸å¼€å¼ ã€‚é€‰æ­¤æ—¥å¼€ä¸šï¼Œè´¢æºå¹¿è¿›ã€‚',
    'çº³è´¢': 'ã€çº³è´¢ã€‘ä»Šæ—¥é€‚åˆæ”¶å–é’±è´¢ã€ç»“ç®—è´¦æ¬¾ã€‚è´¢è¿äº¨é€šï¼Œè¿›è´¢é¡ºåˆ©ã€‚',
    'åŠ¨åœŸ': 'ã€åŠ¨åœŸã€‘ä»Šæ—¥é€‚åˆå»ºæˆ¿åŠ¨å·¥ã€åœ°åŸºå¼€æŒ–ã€‚åŠ¨åœŸå¤§å‰ï¼Œå·¥ç¨‹é¡ºåˆ©ã€‚',
    'å®‰åºŠ': 'ã€å®‰åºŠã€‘ä»Šæ—¥é€‚åˆå®‰ç½®åºŠé“ºã€‚åºŠä½å®‰å®šï¼Œç¡çœ å®‰ç¨³ï¼Œå®¶åº­å’Œç¦ã€‚',
    'å…¥å®…': 'ã€å…¥å®…ã€‘ä»Šæ—¥é€‚åˆæ¬å®¶å…¥ä½ã€ä¹”è¿æ–°å±…ã€‚å…¥ä½æ–°å±…åå®¶è¿äº¨é€šã€‚',
    'å¼€å…‰': 'ã€å¼€å…‰ã€‘ä»Šæ—¥é€‚åˆä½›åƒå¼€å…‰ã€ç¥ä½å¼€å…‰ã€å‰ç¥¥ç‰©å“å¼€å…‰ã€‚å¼€å…‰åçµæ°”åè¶³ã€‚',
    'ä¿®é€ ': 'ã€ä¿®é€ ã€‘ä»Šæ—¥é€‚åˆæˆ¿å±‹ä¿®ç¼®ã€è£…ä¿®æ”¹é€ ã€‚å·¥ç¨‹é¡ºåˆ©ï¼Œè´¨é‡ä¿è¯ã€‚'
};
const JI_EXPLANATIONS = {
    'è¯‰è®¼': 'ã€è¯‰è®¼ã€‘ä»Šæ—¥ä¸å®œæ‰“å®˜å¸ã€èµ·è¯‰ã€‚è‹¥æœ‰çº çº·ï¼Œå®œå’Œè§£ä¸ºä¸Šï¼Œå¦åˆ™å®˜å¸ç¼ èº«ã€‚',
    'å®‰è‘¬': 'ã€å®‰è‘¬ã€‘ä»Šæ—¥ä¸å®œä¸‹è‘¬ã€å®‰æ”¾é—éª¸ã€‚å®œå¦æ‹©å‰æ—¥ã€‚',
    'ç ´åœŸ': 'ã€ç ´åœŸã€‘ä»Šæ—¥ä¸å®œæŒ–æ˜åœŸåœ°ã€å¢“åœ°åŠ¨å·¥ã€‚ææƒŠåŠ¨åœŸç¥ã€‚',
    'ä¼æœ¨': 'ã€ä¼æœ¨ã€‘ä»Šæ—¥ä¸å®œç ‚ä¼æ ‘æœ¨ã€‚æ ‘æœ¨æœ‰çµï¼Œéšæ„ç ä¼æä¼¤å…ƒæ°”ã€‚',
    'ä½œç¶': 'ã€ä½œç¶ã€‘ä»Šæ—¥ä¸å®œå®‰è£…ç¶å°ã€‚ç¶ä¸ºå®¶ä¸­è´¢åº“ï¼Œå®‰è£…ä¸å½“å½±å“è´¢è¿ã€‚',
    'æ˜äº•': 'ã€æ˜äº•ã€‘ä»Šæ—¥ä¸å®œæŒ–æ˜æ°´äº•ã€‚äº•ä¸ºç”Ÿå‘½ä¹‹æºï¼Œæ‹©æ—¥ä¸å½“æå½±å“å¥åº·ã€‚',
    'æ ½ç§': 'ã€æ ½ç§ã€‘ä»Šæ—¥ä¸å®œç§æ¤èŠ±è‰æ ‘æœ¨ã€‚æ¤ç‰©éš¾ä»¥æˆæ´»ï¼Œæˆ–ç”Ÿé•¿ä¸æ—ºã€‚'
};
const CHONGSHA_EXPLANATIONS = {
    chong: {é¼ :'å±é¼ è€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œå®œé™ä¸å®œåŠ¨ã€‚',ç‰›:'å±ç‰›è€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œå®œä¿å®ˆç¨³é‡ã€‚',è™:'å±è™è€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œæ³¨æ„æ§åˆ¶æƒ…ç»ªã€‚',å…”:'å±å…”è€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œå®œä½è°ƒè¡Œäº‹ã€‚',é¾™:'å±é¾™è€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œè°¨æ…ä¸ºä¸Šã€‚',è›‡:'å±è›‡è€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œå®ˆä½æœ¬åˆ†ã€‚',é©¬:'å±é©¬è€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œæ³¨æ„å®‰å…¨ã€‚',ç¾Š:'å±ç¾Šè€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œå®œå®ˆä¸å®œæ”»ã€‚',çŒ´:'å±çŒ´è€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œç¨³å¥ä¸ºä¸Šã€‚',é¸¡:'å±é¸¡è€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œå®œç¼“ä¸å®œæ€¥ã€‚',ç‹—:'å±ç‹—è€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œé¿å…å£èˆŒæ˜¯éã€‚',çŒª:'å±çŒªè€…ä»Šæ—¥ä¸æ—¥æ”¯ç›¸å†²ï¼Œä¸å®œå¼ æ‰¬ã€‚'},
    sha: {ä¸œ:'ç…ä¸œæ–¹ï¼Œä»Šæ—¥ä¸å®œå‘ä¸œæ–¹è¡Œäº‹æˆ–è¿œè¡Œã€‚',è¥¿:'ç…è¥¿æ–¹ï¼Œä»Šæ—¥ä¸å®œå‘è¥¿æ–¹è¡Œäº‹æˆ–è¿œè¡Œã€‚',å—:'ç…å—æ–¹ï¼Œä»Šæ—¥ä¸å®œå‘å—æ–¹è¡Œäº‹æˆ–è¿œè¡Œã€‚',åŒ—:'ç…åŒ—æ–¹ï¼Œä»Šæ—¥ä¸å®œå‘åŒ—æ–¹è¡Œäº‹æˆ–è¿œè¡Œã€‚'},
    jiShen: {å¤©å¾·:'ã€å¤©å¾·ã€‘ä¸ºä¸Šå‰ä¹‹ç¥ï¼Œä¸»ç¦å¾·ï¼Œè¯¸äº‹çš†å®œã€‚',æœˆå¾·:'ã€æœˆå¾·ã€‘ä¸»è´µäººç›¸åŠ©ï¼ŒåŠäº‹é¡ºåˆ©ã€‚',å¤©æ©:'ã€å¤©æ©ã€‘ä¸»ä¸Šå¤©é™ç¦ï¼Œå®œå¹¿ç»“å–„ç¼˜ã€‚',ç¦æ˜Ÿ:'ã€ç¦æ˜Ÿã€‘ä¸»ç¦ç¦„å¯¿å–œï¼Œå®œåŠå–œäº‹ã€‚',æ–‡æ˜Œ:'ã€æ–‡æ˜Œã€‘ä¸»æ–‡è¿å­¦ä¸šï¼Œåˆ©äºè€ƒè¯•å­¦ä¹ ã€‚',é©¿é©¬:'ã€é©¿é©¬ã€‘ä¸»å‡ºè¡Œè¿å¾™ï¼Œåˆ©äºå‡ºå·®æ—…æ¸¸ã€‚',å¤©å–œ:'ã€å¤©å–œã€‘ä¸»å–œäº‹ä¸´é—¨ï¼Œå®œå©šå˜‰åº†å…¸ã€‚',ç‰å ‚:'ã€ç‰å ‚ã€‘ä¸»è´µäººå¥åº·ï¼Œå®œæ±‚åŒ»ç½®äº§ã€‚'},
    xiongShen: {äº”é¬¼:'ã€äº”é¬¼ã€‘ä¸»ç ´è´¢ç–¾ç—…ï¼Œå®œè°¨æ…ç†è´¢ã€‚',æ­»æ°”:'ã€æ­»æ°”ã€‘ä¸»ä¸å‰ï¼Œå®œé¿å…æ¢ç—…åƒä¸§ã€‚',ç™½è™:'ã€ç™½è™ã€‘ä¸»è¡€å…‰äº‰æ–—ï¼Œè°¨é˜²æ„å¤–ã€‚',å¤©åˆ‘:'ã€å¤©åˆ‘ã€‘ä¸»åˆ‘ç½šè®¼äº‰ï¼Œå’Œæ°”ä¸ºè´µã€‚',æœ±é›€:'ã€æœ±é›€ã€‘ä¸»å£èˆŒæ˜¯éï¼Œå°‘è¯´å¤šåšã€‚',å¤©ç‹—:'ã€å¤©ç‹—ã€‘ä¸»å°äººæš—ç®—ï¼Œè°¨æ…äº¤å‹ã€‚'}
};

function showAlmanac() {
    const now = new Date();
    const dateSeed = Utils.getDateSeed(now);
    const lunar = getLunarDate(now);
    const yearGz = CONFIG.TIANGAN[(now.getFullYear()-4)%10] + CONFIG.DIZHI[(now.getFullYear()-4)%12];
    const sx = CONFIG.SHENGXIAO[(now.getFullYear()-4)%12];
    
    // åŸºäºæ—¥æœŸç¡®å®šæ€§é€‰æ‹©å®œå¿Œ
    const yiList = Utils.deterministicSlice(Object.keys(YI_EXPLANATIONS), 5, dateSeed);
    const jiList = Utils.deterministicSlice(Object.keys(JI_EXPLANATIONS), 4, dateSeed + 1000);
    
    const daily = DailyInfo.get();
    const chongSx = daily.chongSx;
    const shaDir = daily.shaDir;
    const jiShen = daily.jiShen;
    const xiongShen = daily.xiongShen;
    
    const chongExp = CHONGSHA_EXPLANATIONS.chong[chongSx] || '';
    const shaExp = CHONGSHA_EXPLANATIONS.sha[shaDir] || '';
    const jiShenExp = CHONGSHA_EXPLANATIONS.jiShen[jiShen.split('ã€')[0]] || '';
    const xiongExp = CHONGSHA_EXPLANATIONS.xiongShen[xiongShen] || '';
    
    const yiHtml = yiList.map(y => `<div style="background:var(--bg-card);border-radius:8px;padding:10px;margin:5px 0;font-size:0.85rem;">${YI_EXPLANATIONS[y]}</div>`).join('');
    const jiHtml = jiList.map(j => `<div style="background:var(--bg-card);border-radius:8px;padding:10px;margin:5px 0;font-size:0.85rem;">${JI_EXPLANATIONS[j]}</div>`).join('');
    
    DOM.almanacContent.innerHTML = `
        <div class="almanac-date">
            <div class="almanac-day">${now.getDate()}</div>
            <div class="almanac-info">
                <div class="year">${now.getFullYear()}å¹´${now.getMonth()+1}æœˆ</div>
                <div class="week">æ˜ŸæœŸ${CONFIG.WEEKDAYS[now.getDay()]}</div>
                <div class="lunar">å†œå† ${lunar}</div>
                <div class="ganzhi">${yearGz}å¹´ã€${sx}å¹´ã€‘</div>
            </div>
        </div>
        <div class="yiji-box"><span class="yiji-label yi-label">å®œ</span><span class="yiji-content">${yiList.join('  ')}</span></div>
        <div class="yiji-box"><span class="yiji-label ji-label">å¿Œ</span><span class="yiji-content">${jiList.join('  ')}</span></div>
        <div style="display:flex;flex-wrap:wrap;gap:15px;margin-top:15px;font-size:0.9rem;">
            <span>âš¡ å†²${chongSx}</span><span>ğŸ§­ ç…${shaDir}</span>
            <span>ğŸŒŸ å‰ç¥ï¼š${jiShen}</span><span style="color:var(--red);">ğŸ‘¹ å‡¶ç¥ï¼š${xiongShen}</span>
        </div>
        <div style="margin-top:20px;"><div class="card-title" style="color:var(--cyan);">ğŸ“š å†²ç…å‰å‡¶è¯¦è§£</div>
            <div style="background:var(--bg-hover);border-radius:8px;padding:12px;margin:8px 0;font-size:0.85rem;line-height:1.8;">
                <div style="margin-bottom:6px;"><span style="color:var(--red);font-weight:bold;">âš¡ å†²${chongSx}</span>ï¼š${chongExp}</div>
                <div style="margin-bottom:6px;"><span style="color:var(--orange);font-weight:bold;">ğŸ§­ ç…${shaDir}</span>ï¼š${shaExp}</div>
                <div style="margin-bottom:6px;"><span style="color:var(--green);font-weight:bold;">ğŸŒŸ å‰ç¥</span>ï¼š${jiShenExp}</div>
                <div><span style="color:var(--red);font-weight:bold;">ğŸ‘¹ å‡¶ç¥</span>ï¼š${xiongExp}</div>
            </div>
        </div>
        <div style="margin-top:20px;"><div class="card-title" style="color:var(--green);">âœ… ä»Šæ—¥å®œäº‹è¯¦è§£</div>${yiHtml}</div>
        <div style="margin-top:20px;"><div class="card-title" style="color:var(--red);">âŒ ä»Šæ—¥å¿Œäº‹è¯¦è§£</div>${jiHtml}</div>
        <div class="hint-text" style="margin-top:20px;">âœ¨ é¡ºåº”å¤©æ—¶ï¼Œè¶‹å‰é¿å‡¶ï¼Œå¹³å®‰é¡ºé‚ âœ¨</div>
    `;
}

// ============ å©šå§»é…å¯¹ ============
// ç”Ÿè‚–é…å¯¹è¡¨ï¼ˆåŸºäºä¼ ç»Ÿå‘½ç†å­¦ï¼‰
const ZODIAC_MATCH = {
    // ä¸‰åˆå±€ï¼šç”³å­è¾°åˆæ°´ã€äº¥å¯æœªåˆæœ¨ã€å¯…åˆæˆŒåˆç«ã€å·³é…‰ä¸‘åˆé‡‘
    sanhe: [[0,4,8], [3,7,11], [2,6,10], [1,5,9]], // ç´¢å¼•å¯¹åº”ç”Ÿè‚–
    // å…­åˆï¼šå­ä¸‘ã€å¯…äº¥ã€å¯æˆŒã€è¾°é…‰ã€å·³ç”³ã€åˆæœª
    liuhe: [[0,1], [2,11], [3,10], [4,9], [5,8], [6,7]],
    // å…­å†²ï¼šå­åˆã€ä¸‘æœªã€å¯…ç”³ã€å¯é…‰ã€è¾°æˆŒã€å·³äº¥
    liuchong: [[0,6], [1,7], [2,8], [3,9], [4,10], [5,11]],
    // å…­å®³ï¼šå­æœªã€ä¸‘åˆã€å¯…å·³ã€å¯è¾°ã€ç”³äº¥ã€é…‰æˆŒ
    liuhai: [[0,7], [1,6], [2,5], [3,4], [8,11], [9,10]]
};

function getZodiacScore(male, female) {
    const mIdx = CONFIG.SHENGXIAO.indexOf(male);
    const fIdx = CONFIG.SHENGXIAO.indexOf(female);
    
    // æ£€æŸ¥ä¸‰åˆï¼ˆ+25åˆ†ï¼‰
    let sanheBonus = 0;
    for (const group of ZODIAC_MATCH.sanhe) {
        if (group.includes(mIdx) && group.includes(fIdx)) {
            sanheBonus = 25;
            break;
        }
    }
    
    // æ£€æŸ¥å…­åˆï¼ˆ+20åˆ†ï¼‰
    let liuheBonus = 0;
    for (const pair of ZODIAC_MATCH.liuhe) {
        if ((pair[0] === mIdx && pair[1] === fIdx) || (pair[0] === fIdx && pair[1] === mIdx)) {
            liuheBonus = 20;
            break;
        }
    }
    
    // æ£€æŸ¥å…­å†²ï¼ˆ-20åˆ†ï¼‰
    let liuchongPenalty = 0;
    for (const pair of ZODIAC_MATCH.liuchong) {
        if ((pair[0] === mIdx && pair[1] === fIdx) || (pair[0] === fIdx && pair[1] === mIdx)) {
            liuchongPenalty = -20;
            break;
        }
    }
    
    // æ£€æŸ¥å…­å®³ï¼ˆ-10åˆ†ï¼‰
    let liuhaiPenalty = 0;
    for (const pair of ZODIAC_MATCH.liuhai) {
        if ((pair[0] === mIdx && pair[1] === fIdx) || (pair[0] === fIdx && pair[1] === mIdx)) {
            liuhaiPenalty = -10;
            break;
        }
    }
    
    // åŸºç¡€åˆ†70åˆ†
    const baseScore = 70;
    const totalScore = Math.min(99, Math.max(60, baseScore + sanheBonus + liuheBonus + liuchongPenalty + liuhaiPenalty));
    
    return totalScore;
}

function calculateMatch() {
    const male = DOM.maleZodiac.value;
    const female = DOM.femaleZodiac.value;
    
    // åŸºäºç”Ÿè‚–é…å¯¹è¡¨ç¡®å®šæ€§è®¡ç®—åˆ†æ•°
    const score = getZodiacScore(male, female);
    
    let level, color, desc;
    if (score >= 90) {
        level = 'å¤©ä½œä¹‹åˆ'; color = 'var(--gold)';
        desc = 'æ­¤ä¹ƒå¤©èµè‰¯ç¼˜ï¼ŒäºŒäººå…«å­—ç›¸åˆï¼Œäº”è¡Œäº’è¡¥ï¼Œå©šåå¿…å®šç´ç‘Ÿå’Œé¸£ï¼Œç™½å¤´å•è€ã€‚';
    } else if (score >= 80) {
        level = 'ä¸Šç­‰å©šé…'; color = 'var(--green)';
        desc = 'äºŒäººå§»ç¼˜ä¸æµ…ï¼Œæ€§æ ¼äº’è¡¥ï¼Œç›¸å¤„èæ´½ï¼Œæºæ‰‹åŒè¡Œå®šèƒ½å…±åˆ›ç¾å¥½æœªæ¥ã€‚';
    } else if (score >= 70) {
        level = 'ä¸­ç­‰å©šé…'; color = 'var(--purple-light)';
        desc = 'å§»ç¼˜å°šå¯ï¼Œéœ€è¦åŒæ–¹å¤šåŠ åŒ…å®¹ç†è§£ï¼Œç”¨å¿ƒç»è¥æ–¹èƒ½å¹¸ç¦ç¾æ»¡ã€‚';
    } else {
        level = 'éœ€è¦ç£¨åˆ'; color = 'var(--orange)';
        desc = 'äºŒäººæ€§æ ¼æœ‰æ‰€å†²çªï¼Œéœ€è¦æ›´å¤šæ²Ÿé€šä¸ç†è§£ï¼Œå»ºè®®å©šå‰å¤šåŠ è€ƒè™‘ã€‚';
    }
    
    // åŸºäºç”Ÿè‚–ç´¢å¼•ç¡®å®šæ€§è®¡ç®—è¯¦æƒ…
    const mIdx = CONFIG.SHENGXIAO.indexOf(male);
    const fIdx = CONFIG.SHENGXIAO.indexOf(female);
    const detailSeed = mIdx * 12 + fIdx;
    
    const details = [
        ['æ€§æ ¼ç›¸åˆåº¦', 70 + Utils.deterministicInt(detailSeed, 0, 24)],
        ['ä»·å€¼è§‚å¥‘åˆ', 65 + Utils.deterministicInt(detailSeed + 100, 0, 29)],
        ['ç”Ÿæ´»ä¹ æƒ¯', 60 + Utils.deterministicInt(detailSeed + 200, 0, 34)],
        ['è´¢è¿äº’è¡¥', 70 + Utils.deterministicInt(detailSeed + 300, 0, 24)]
    ];
    
    DOM.matchResult.innerHTML = `
        <div class="card match-result">
            <div style="font-size:1.3rem; color:var(--gold);">ğŸ’‘ ${male} â¤ ${female}</div>
            <div class="match-score">${score}</div>
            <div style="font-size:0.9rem; color:var(--text-dim);">å¥‘åˆæŒ‡æ•°</div>
            <div class="match-level" style="color:${color};">${level}</div>
            <div class="match-desc">${desc}</div>
        </div>
        
        <div class="card">
            ${details.map(([name, val]) => `
                <div class="progress-row">
                    <span class="progress-label">${name}</span>
                    <div class="progress-bar"><div class="progress-fill" style="width:${val}%"></div></div>
                    <span class="progress-value">${val}%</span>
                </div>
            `).join('')}
        </div>
    `;
}

// å¯åŠ¨
init();
</script>
</body>
</html>
